var app=new Vue({
    el:"#app",
    data:function(){
        return {
            formData:{
                book_id:null,
                book_name:null,
                page:1,
            },
            pager:null,
            list:null,
            currentBookIndex:0,
            borrowInfo:{
                student_id:null,
                borrow_days:30,
                book_id:null,
            }
        }
    },
    methods:{
        showBorrowBook(bookIndex){
            this.currentBookIndex=bookIndex;
            this.$refs["popupBorrow"].show();
        },
        borrowBook(){
            if(!this.borrowInfo.student_id){
                this.$toast("请输入学号！");
                return;
            }
            this.borrowInfo.book_id=this.list[this.currentBookIndex].book_id;
            let formData=this.borrowInfo;
            getData(`/admin/borrow`,this,{method:"post",formData}).then(r=>{
                this.$toast("图书借出成功！");
                this.list[this.currentBookIndex].borrow_state=1;
                this.$refs["popupBorrow"].hide();
            })
        },
        deletBook(book,bookIndex){
            this.$confirm(`确认将ID为${book.book_id}，名称为《${book.book_name}》的书籍下架吗？`).then(()=>{
                console.log("删除书籍")
                let formData={
                    book_id:book.book_id
                }
                getData("/admin/book/delete",this,{method:"delete",formData}).then(r=>{
                    this.list[bookIndex].delete_state=1;
                })
            })
        },
        reset(){
            this.formData.book_id=null;
            this.formData.book_name=null;
            this.research();
        },
        research(i){
            this.formData.page=i||1;
            this.getList();
        },
        getList(){
            getData('/admin/book/list',this,{formData:this.formData}).then(r=>{
                this.list=r.list;
                this.pager=r.pager;
            })
        }
    },
    created(){
        this.getList()
    },
    mounted(){
    }
})